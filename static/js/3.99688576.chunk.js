(this["webpackJsonpjonshort.me"]=this["webpackJsonpjonshort.me"]||[]).push([[3],{36:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.withMDXComponents=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o=m(n(1)),r=m(n(40)),s=m(n(11));function m(e){return e&&e.__esModule?e:{default:e}}var c=(0,r.default)({}),l=c.Provider,p=c.Consumer;t.withMDXComponents=function(e){return function(t){var n=t.components,r=function(e,t){var n={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}(t,["components"]);return o.default.createElement(p,null,(function(t){return o.default.createElement(e,a({components:n||t},r))}))}};var i=function(e){var t=e.components,n=e.children;return o.default.createElement(l,{value:t},n)};i.propTypes={components:s.default.object.isRequired,children:s.default.element.isRequired},t.default=i},37:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(38);Object.defineProperty(t,"MDXTag",{enumerable:!0,get:function(){return r(a).default}});var o=n(36);function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"MDXProvider",{enumerable:!0,get:function(){return r(o).default}})},38:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(1),s=l(r),m=l(n(39)),c=n(36);function l(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var h={inlineCode:"code",wrapper:"div"},u=function(e){function t(){return p(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.parentName,o=e.props,r=void 0===o?{}:o,c=e.children,l=e.components,p=void 0===l?{}:l,i=e.Layout,u=e.layoutProps,g=p[n+"."+t]||p[t]||h[t]||t;return i?((0,m.default)(this,i),s.default.createElement(i,a({components:p},u),s.default.createElement(g,r,c))):s.default.createElement(g,r,c)}}]),t}(r.Component);t.default=(0,c.withMDXComponents)(u)},39:function(e,t,n){"use strict";var a={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r=Object.defineProperty,s=Object.getOwnPropertyNames,m=Object.getOwnPropertySymbols,c=Object.getOwnPropertyDescriptor,l=Object.getPrototypeOf,p=l&&l(Object);e.exports=function e(t,n,i){if("string"!==typeof n){if(p){var h=l(n);h&&h!==p&&e(t,h,i)}var u=s(n);m&&(u=u.concat(m(n)));for(var g=0;g<u.length;++g){var d=u[g];if(!a[d]&&!o[d]&&(!i||!i[d])){var f=c(n,d);try{r(t,d,f)}catch(v){}}}return t}return t}},40:function(e,t,n){"use strict";t.__esModule=!0;var a=r(n(1)),o=r(n(41));function r(e){return e&&e.__esModule?e:{default:e}}t.default=a.default.createContext||o.default,e.exports=t.default},41:function(e,t,n){"use strict";t.__esModule=!0;var a=n(1),o=(s(a),s(n(11))),r=s(n(42));s(n(43));function s(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function l(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var p=1073741823;function i(e){var t=[];return{on:function(e){t.push(e)},off:function(e){t=t.filter((function(t){return t!==e}))},get:function(){return e},set:function(n,a){e=n,t.forEach((function(t){return t(e,a)}))}}}t.default=function(e,t){var n,s,h="__create-react-context-"+(0,r.default)()+"__",u=function(e){function n(){var t,a;m(this,n);for(var o=arguments.length,r=Array(o),s=0;s<o;s++)r[s]=arguments[s];return t=a=c(this,e.call.apply(e,[this].concat(r))),a.emitter=i(a.props.value),c(a,t)}return l(n,e),n.prototype.getChildContext=function(){var e;return(e={})[h]=this.emitter,e},n.prototype.componentWillReceiveProps=function(e){if(this.props.value!==e.value){var n=this.props.value,a=e.value,o=void 0;((r=n)===(s=a)?0!==r||1/r===1/s:r!==r&&s!==s)?o=0:(o="function"===typeof t?t(n,a):p,0!==(o|=0)&&this.emitter.set(e.value,o))}var r,s},n.prototype.render=function(){return this.props.children},n}(a.Component);u.childContextTypes=((n={})[h]=o.default.object.isRequired,n);var g=function(t){function n(){var e,a;m(this,n);for(var o=arguments.length,r=Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=a=c(this,t.call.apply(t,[this].concat(r))),a.state={value:a.getValue()},a.onUpdate=function(e,t){0!==((0|a.observedBits)&t)&&a.setState({value:a.getValue()})},c(a,e)}return l(n,t),n.prototype.componentWillReceiveProps=function(e){var t=e.observedBits;this.observedBits=void 0===t||null===t?p:t},n.prototype.componentDidMount=function(){this.context[h]&&this.context[h].on(this.onUpdate);var e=this.props.observedBits;this.observedBits=void 0===e||null===e?p:e},n.prototype.componentWillUnmount=function(){this.context[h]&&this.context[h].off(this.onUpdate)},n.prototype.getValue=function(){return this.context[h]?this.context[h].get():e},n.prototype.render=function(){return(e=this.props.children,Array.isArray(e)?e[0]:e)(this.state.value);var e},n}(a.Component);return g.contextTypes=((s={})[h]=o.default.object,s),{Provider:u,Consumer:g}},e.exports=t.default},42:function(e,t,n){"use strict";(function(t){var n="__global_unique_id__";e.exports=function(){return t[n]=(t[n]||0)+1}}).call(this,n(17))},43:function(e,t,n){"use strict";var a=n(44);e.exports=a},44:function(e,t,n){"use strict";function a(e){return function(){return e}}var o=function(){};o.thatReturns=a,o.thatReturnsFalse=a(!1),o.thatReturnsTrue=a(!0),o.thatReturnsNull=a(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(e){return e},e.exports=o},45:function(e,t,n){"use strict";function a(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}n.d(t,"a",(function(){return a}))},47:function(e,t,n){"use strict";n.r(t);var a=n(45),o=n(1),r=n.n(o),s=n(37);t.default=function(e){var t=e.components;Object(a.a)(e,["components"]);return r.a.createElement(s.MDXTag,{name:"wrapper",components:t},r.a.createElement(s.MDXTag,{name:"p",components:t},"The 'problem' in this article involves environment variables. In this first section I give some info around environment variables - feel free to skip this if you're already familiar \ud83d\udc4d"),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Environment variables"),r.a.createElement(s.MDXTag,{name:"p",components:t},r.a.createElement(s.MDXTag,{name:"a",components:t,parentName:"p",props:{href:"https://en.wikipedia.org/wiki/Environment_variable"}},"Environment variables")," are great. Code can do different things or perform different actions simply by taking into account the environment it's running within."),r.a.createElement(s.MDXTag,{name:"p",components:t},"Generally there are two different types of environment variables:"),r.a.createElement(s.MDXTag,{name:"ul",components:t},r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},"global"),r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},"process")),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Global"),r.a.createElement(s.MDXTag,{name:"p",components:t},"Global env vars belong to the operating system, and are often used when a variable needs to be persisted across processes (e.g. a path to a shared file)."),r.a.createElement("small",null,"Example - on linux-based systems `printenv` shows the current env vars"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"$ printenv\n  ZSH=/Users/abc/.oh-my-zsh\n  GOPATH=/Users/abc/go\n  NVM_DIR=/Users/abc/.nvm\n\n$ echo $GOPATH\n  /Users/abc/go\n")),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Process"),r.a.createElement(s.MDXTag,{name:"p",components:t},"Process env vars only associate themselves with one command, usually used when the same command could be run multiple times with different options."),r.a.createElement("small",null,"Example - here we set a process-specific env var of GREETING, which only affects the process it is run alongside"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"$ GREETING=hello bash -c 'echo \"$GREETING\"'\n  hello\n\n$ GREETING=goodbye bash -c 'echo \"$GREETING\"'\n  goodbye\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},"Now if we check the global env vars, we won't see an entry for GREETING, because it was set per-process"),r.a.createElement("small",null,"Example - here passing an argument to printenv shows the value for that specific env var"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"$ printenv GREETING\n  \n")),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Handling lots of environment variables"),r.a.createElement(s.MDXTag,{name:"p",components:t},"As projects get larger sometimes the amount of environment variables that need to be passed to each process can become a bit unwieldy."),r.a.createElement(s.MDXTag,{name:"p",components:t},"Javascript-based projects often use a ",r.a.createElement(s.MDXTag,{name:"a",components:t,parentName:"p",props:{href:"https://github.com/motdotla/dotenv"}},".env")," file to solve this, with all vars being added to the file, and everything within it being made available to the running process as environment variables (similar to process-based vars)."),r.a.createElement("small",null,"Example - an example .env file that might be used for local development"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"API_URL=http://localhost:6000\nAUTH_PROVIDER=http://localhost:4000\nHTTP_TIMEOUT=60000\nNODE_ENV=development\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},"This is developer-friendly as all our variables are stored in a single place, and we can easily see what settings will be used when we run the process."),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Switching out environment variables"),r.a.createElement(s.MDXTag,{name:"p",components:t},"Looking at the example in the previous section, let's imagine that we're asked to test a production build, and run against live URLs rather than localhost."),r.a.createElement(s.MDXTag,{name:"p",components:t},"With a .env file we just need to update the URLs within the file to the correct live URLs:"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-diff",metaString:""}},"- API_URL=http://localhost:6000\n+ API_URL=https://api.jonshort.me\n- AUTH_PROVIDER=http://localhost:4000\n+ AUTH_PROVIDER=http://auth.jonshort.me\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},"Now our .env file looks like this:"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"API_URL=https://api.jonshort.me\nAUTH_PROVIDER=http://auth.jonshort.me\nHTTP_TIMEOUT=60000\nNODE_ENV=development\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},"\ud83d\ude00 Nice! We've switched out the URLs and should be ready to go."),r.a.createElement(s.MDXTag,{name:"p",components:t},"..."),r.a.createElement(s.MDXTag,{name:"p",components:t},"\ud83d\ude33 Oops, we almost forgot to update the ",r.a.createElement(s.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"NODE_ENV")," to simulate a production build:"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-diff",metaString:""}},"- NODE_ENV=development\n+ NODE_ENV=production\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},"Let's take another look at our .env file:"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"API_URL=https://api.jonshort.me\nAUTH_PROVIDER=http://auth.jonshort.me\nHTTP_TIMEOUT=60000\nNODE_ENV=production\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},"\ud83e\udd73 Great! Let's run our application"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"$ node ./my-application.js\n  - - - - - - - - - - - - - -\n  Starting production mode...\n  - - - - - - - - - - - - - -\n  ERROR - unable to connect to auth API over HTTP - please use HTTPS\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},"..."),r.a.createElement(s.MDXTag,{name:"p",components:t},"\ud83e\udd14 Hmm, looks like we made a mistake in the .env file, let's update that AUTH_PROVIDER value:"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-diff",metaString:""}},"- AUTH_PROVIDER=http://auth.jonshort.me\n+ AUTH_PROVIDER=https://auth.jonshort.me\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},"\ud83d\ude05 Phew! Ok here's the final .env file:"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"API_URL=https://api.jonshort.me\nAUTH_PROVIDER=https://auth.jonshort.me\nHTTP_TIMEOUT=60000\nNODE_ENV=production\n")),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Here's where our problem appears"),r.a.createElement(s.MDXTag,{name:"p",components:t},'When we were asked to "test a production build, and run against live URLs rather than localhost" we knew ',r.a.createElement(s.MDXTag,{name:"em",components:t,parentName:"p"},"where")," to update the values, but we didn't know ",r.a.createElement(s.MDXTag,{name:"em",components:t,parentName:"p"},"what")," to update the values to."),r.a.createElement(s.MDXTag,{name:"p",components:t},"This is one of the problems with env vars in general - unless they're documented by developers, the values need to be manually updated, and even then misspellings or typos can cause problems."),r.a.createElement(s.MDXTag,{name:"p",components:t},"Imagine you were working on a project for the first time - there's no way you'd know what values to use! \ud83d\ude31"),r.a.createElement(s.MDXTag,{name:"h3",components:t},"How I approached this problem when I faced it"),r.a.createElement(s.MDXTag,{name:"p",components:t},"In my day job at ",r.a.createElement(s.MDXTag,{name:"a",components:t,parentName:"p",props:{href:"https://www.experian.co.uk/"}},"Experian")," I was having to update the local env vars for my primary project multiple times a day; often going into the file just to check what the current configuration was."),r.a.createElement(s.MDXTag,{name:"p",components:t},"There were two use-cases:"),r.a.createElement(s.MDXTag,{name:"ul",components:t},r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},"Target a locally-mocked backend"),r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},"Target a hosted, integration-testing backend")),r.a.createElement(s.MDXTag,{name:"p",components:t},"Switching these involved changing a number of env vars, and it was easy to accidentally miss one, even when doing it so often."),r.a.createElement(s.MDXTag,{name:"p",components:t},"I had the idea to create a command-line interface (CLI) which would update the individual env vars to the correct value and allow me to choose between ",r.a.createElement(s.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"mock")," and ",r.a.createElement(s.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"int"),"."),r.a.createElement(s.MDXTag,{name:"p",components:t},"My idea for usage was something like this:"),r.a.createElement("small",null,"Example - Switching to mocked backend"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"$ update-env mock\n  env is now mock\n")),r.a.createElement("small",null,"Example - Switching to integration-test backend"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"$ update-env int\n  env is now int\n")),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Writing the CLI"),r.a.createElement(s.MDXTag,{name:"p",components:t},'When I was thinking about the env var problem, my thoughts were "we have these few vars that need to be updated to switch between mock and int".'),r.a.createElement(s.MDXTag,{name:"p",components:t},"Following this, I wrote a CLI which included the values for both, and when executed would go through the .env file and update the vars which required it."),r.a.createElement(s.MDXTag,{name:"p",components:t},"So within the CLI code, I created a list of the vars, and their value for both mock and int, something like:"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-md",metaString:""}},"VAR_A\n  - mock = http://localhost:6000\n  - int = https://api.jonshort.me\nVAR_B\n  - mock = http://localhost:4000\n  - int = https://auth.jonshort.me\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},"Then when the CLI was executed, the code would read each var in the .env file and if it matched one in the list above, update it to the value based on the current argument."),r.a.createElement(s.MDXTag,{name:"p",components:t},"So usage-wise it fit the original idea:"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"$ update-env int\n  env is now int\n")),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Inflexibility"),r.a.createElement(s.MDXTag,{name:"p",components:t},"The CLI worked well, and I no longer had to worry about updating env vars, since i could just run ",r.a.createElement(s.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"update-env")," and I'd know that the vars would be valid."),r.a.createElement(s.MDXTag,{name:"p",components:t},"Some annoying aspects did start to appear over time though:"),r.a.createElement(s.MDXTag,{name:"ul",components:t},r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},"If an env var needed to change, it required a change to the CLI code"),r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},"I could only use it on one project"),r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},"Other developers would only be able to use the same ",r.a.createElement(s.MDXTag,{name:"inlineCode",components:t,parentName:"li"},"mock")," and ",r.a.createElement(s.MDXTag,{name:"inlineCode",components:t,parentName:"li"},"int")," options with it")),r.a.createElement(s.MDXTag,{name:"p",components:t},'For a while I just accepted this issues since the problem "change these env vars" was solved.'),r.a.createElement(s.MDXTag,{name:"p",components:t},"But as I worked on more projects outside of the one which I'd made the CLI for, it became increasingly annoying to remember all the different combinations of env vars."),r.a.createElement(s.MDXTag,{name:"p",components:t},"I decided there must be a way to have the same functionality but written in a way that any project could use."),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Re-framing the problem"),r.a.createElement(s.MDXTag,{name:"p",components:t},'Now that we need a more "generic" way to handle this functionality, let\'s think about ',r.a.createElement(s.MDXTag,{name:"em",components:t,parentName:"p"},"where")," the information the CLI needs to function should live."),r.a.createElement(s.MDXTag,{name:"ul",components:t},r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},"All possible vars need to exist somewhere in the target project, not the CLI"),r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},'The "keyword" should be whatever the developer chooses'),r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},"Developers that don't use the CLI shouldn't be forced to use it or be affected by the changes")),r.a.createElement(s.MDXTag,{name:"p",components:t},"With these restrictions in mind, we could allow projects to include a separate configuration file with env vars for the keywords they need, e.g:"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-json",metaString:""}},'{\n  "mock": {\n    "VAR_A": "http://localhost:6000",\n    "VAR_B": "http://localhost:4000"\n  },\n  "int": {\n    "VAR_A": "https://api.jonshort.me",\n    "VAR_B": "https://auth.jonshort.me"\n  }\n}\n')),r.a.createElement(s.MDXTag,{name:"p",components:t},"This would be good for our CLI (since we have a reliable / predictable structure of values) but for users this would be annoying - they're being asked to introduce a separate file, ",r.a.createElement(s.MDXTag,{name:"em",components:t,parentName:"p"},"just")," to help the CLI work out which env vars to use."),r.a.createElement(s.MDXTag,{name:"p",components:t},"For developers who don't know about the CLI, they'd have to deal with this random file without knowing what it was for, and the file would inevitably become outdated."),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Comments to the rescue!"),r.a.createElement(s.MDXTag,{name:"p",components:t},"Let's see if we can somehow store the data needed for the CLI alongside the actual vars. Out of the box .env files allow comments, which are an easy way for documentation or notes to be added to a .env file."),r.a.createElement("small",null,"Example - Comments giving a bit more information about what the vars do"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"# Main API URL\nVAR_A=http://localhost:6000\n\n# Auth API URL\nVAR_B=http://localhost:4000\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},"Could we leverage that comments don't affect the actual usage of the .env file, and let developers include their vars for each keyword within it?"),r.a.createElement(s.MDXTag,{name:"p",components:t},'We could allow developers to include "blocks" of vars, for each keyword, e.g:'),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"# mock\n# VAR_A=http://localhost:6000\n# VAR_B=http://localhost:4000\n\n# int\n# VAR_A=https://api.jonshort.me\n# VAR_B=https://auth.jonshort.me\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},"Then when we execute the CLI, it could uncomment the relevant vars, e.g:"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"$ update-env int\n")),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"# mock\n# VAR_A=http://localhost:6000\n# VAR_B=http://localhost:4000\n\n# int\nVAR_A=https://api.jonshort.me\nVAR_B=https://auth.jonshort.me\n")),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Patterns to the rescue!"),r.a.createElement(s.MDXTag,{name:"p",components:t},"We're almost there with the CLI, we just need a clear way for developers to signal which env vars to update."),r.a.createElement(s.MDXTag,{name:"p",components:t},'Previously we added comment "blocks" with the vars for each keyword in. This would probably work, but the CLI would struggle to differentiate between a regular comment and a keyword, e.g:'),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"# mock\n# VAR_A=http://localhost:6000\n# VAR_B=http://localhost:4000\n\n# my name\nNAME=jon\n\n# int\n# VAR_A=https://api.jonshort.me\n# VAR_B=https://auth.jonshort.me\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},'Here we\'d have to think up some way to parse "mock" as a keyword, but "my name" as a regular comment.'),r.a.createElement(s.MDXTag,{name:"p",components:t},"..."),r.a.createElement(s.MDXTag,{name:"p",components:t},"Here's where patterns come in handy."),r.a.createElement(s.MDXTag,{name:"p",components:t},"We can add an uncommon pattern to the start of keyword comments, allowing the CLI to easily interpret them as keywords!"),r.a.createElement(s.MDXTag,{name:"p",components:t},"Let's try it out:"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"# ++ mock ++\n# VAR_A=http://localhost:6000\n# VAR_B=http://localhost:4000\n\n# my name\nNAME=jon\n\n# ++ int ++\n# VAR_A=https://api.jonshort.me\n# VAR_B=https://auth.jonshort.me\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},'Now when we check each line, we know that any comment that starts with "++" is ',r.a.createElement(s.MDXTag,{name:"em",components:t,parentName:"p"},"probably")," a keyword."),r.a.createElement(s.MDXTag,{name:"p",components:t},"To parse this using regex it'd be something like:"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-regex",metaString:""}},"/^#+ *\\+\\+ *(\\w+)/g\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},"With this regex we can use the ",r.a.createElement(s.MDXTag,{name:"a",components:t,parentName:"p",props:{href:"https://www.tutorialspoint.com/javaregex/javaregex_capturing_groups.htm"}},"capture group")," to give us the keyword without much hassle \ud83d\udc4d"),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Testing it out"),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"$ update-env mock\n")),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"# ++ mock ++\nVAR_A=http://localhost:6000\nVAR_B=http://localhost:4000\n\n# my name\nNAME=jon\n\n# ++ int ++\n# VAR_A=https://api.jonshort.me\n# VAR_B=https://auth.jonshort.me\n")),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"$ update-env int\n")),r.a.createElement(s.MDXTag,{name:"pre",components:t},r.a.createElement(s.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-bash",metaString:""}},"# ++ mock ++\n# VAR_A=http://localhost:6000\n# VAR_B=http://localhost:4000\n\n# my name\nNAME=jon\n\n# ++ int ++\nVAR_A=https://api.jonshort.me\nVAR_B=https://auth.jonshort.me\n")),r.a.createElement(s.MDXTag,{name:"p",components:t},'Nice! This works, and we\'re not seeing any issues with the "my name" area \ud83c\udf89'),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Looking back"),r.a.createElement(s.MDXTag,{name:"p",components:t},"So now we have a solution that:"),r.a.createElement(s.MDXTag,{name:"ul",components:t},r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},"works on any project"),r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},"can accept any keyword"),r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},"entirely developer-configured, no need for CLI changes"),r.a.createElement(s.MDXTag,{name:"li",components:t,parentName:"ul"},"can be totally ignored by developers that don't use it")),r.a.createElement(s.MDXTag,{name:"p",components:t},'We were only able to achieve this because we re-framed our problem from "how can I update these vars in my project" to "how can we enable anyone to update env vars on any project".'),r.a.createElement(s.MDXTag,{name:"p",components:t},'There\'s often a balance with this type of re-framing, as it can easily fall into "scope creep" whereby we spend so long thinking about related issues that the solution becomes bloated or unmanageable.'),r.a.createElement(s.MDXTag,{name:"p",components:t},"Generally it's worth manipulating your problem when starting a task, as it's less harmful at that stage if the solution needs to be approached in a different way."),r.a.createElement(s.MDXTag,{name:"p",components:t},"Keep in mind the balance between generic / tailored solutions, as generic solutions aren't always the best way to go about something if the tailored solution would offer better performance, maintainability, or flexibility."),r.a.createElement(s.MDXTag,{name:"h3",components:t},"Quick plug - cenv"),r.a.createElement(s.MDXTag,{name:"p",components:t},"I tried not to go into the actual code behind the CLI too much in this article, mostly because it's focused on the problem / solution relationship."),r.a.createElement(s.MDXTag,{name:"p",components:t},'The code around the CLI as referred in the updated solution is available on github as "cenv" (short for "change env") - ',r.a.createElement(s.MDXTag,{name:"a",components:t,parentName:"p",props:{href:"https://github.com/JonShort/cenv"}},"https://github.com/JonShort/cenv")),r.a.createElement(s.MDXTag,{name:"p",components:t},"I use it on most of my projects now, as a quick way to switch between envs without having to remember a load of values \ud83d\ude05"),r.a.createElement(s.MDXTag,{name:"p",components:t},"Please check it out, it's written in rust, but feel free to copy the idea into another language (it'd be nice if it was a bit easier for users)."),r.a.createElement(s.MDXTag,{name:"p",components:t},"Thanks for reading,"),r.a.createElement(s.MDXTag,{name:"p",components:t},"Jon \ud83d\ude03"))}}}]);
//# sourceMappingURL=3.99688576.chunk.js.map